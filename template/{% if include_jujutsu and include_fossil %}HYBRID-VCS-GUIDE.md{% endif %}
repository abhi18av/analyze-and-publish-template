# Hybrid Version Control: Jujutsu + Fossil SCM for Academic Research

## Overview

This template integrates **Jujutsu (jj)** with **Fossil SCM** to create a comprehensive version control system tailored for academic research workflows. Each system serves specific purposes while maintaining compatibility and synchronization.

## System Architecture

### ğŸ”„ **Dual-Layer Strategy**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PRIMARY LAYER (jj + Git)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Daily development workflow                                â”‚
â”‚ â€¢ Experimental branching                                    â”‚
â”‚ â€¢ Collaboration via GitHub/GitLab                          â”‚
â”‚ â€¢ CI/CD integration                                         â”‚
â”‚ â€¢ Real-time conflict resolution                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ARCHIVAL LAYER (Fossil)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Self-contained manuscript versioning                     â”‚
â”‚ â€¢ Computational provenance tracking                        â”‚
â”‚ â€¢ Long-term preservation                                    â”‚
â”‚ â€¢ Publication-ready bundles                                â”‚
â”‚ â€¢ Offline access and web UI                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Benefits of This Hybrid Approach

### ğŸš€ **Why Jujutsu (Primary Layer)?**

1. **Frictionless Experimentation**
   - Anonymous commits encourage frequent saves during analysis
   - Easy history rewriting for clean publication history
   - Superior conflict resolution for collaborative research

2. **Modern Development Workflow**
   - Compatible with existing Git infrastructure
   - Excellent performance with large repositories
   - Powerful revset queries for finding specific experiments

3. **Academic Collaboration**
   - Seamless integration with GitHub/GitLab workflows
   - CI/CD compatibility for automated testing
   - Real-time collaboration without complex branching

### ğŸ¦´ **Why Fossil SCM (Archival Layer)?**

1. **Self-Contained Archives**
   - Single-file repositories perfect for publication supplements
   - Built-in web UI for reviewing manuscript history
   - No external dependencies for long-term access

2. **Manuscript Versioning**
   - Ideal for tracking manuscript evolution
   - Clear timeline view for editorial processes
   - Easy version comparisons and rollbacks

3. **Computational Provenance**
   - Track analysis environments and dependencies
   - Link manuscript changes to specific analysis versions
   - Generate publication-ready research trails

## Repository Structure

```
project/
â”œâ”€â”€ .jj/                          # Jujutsu primary repository
â”œâ”€â”€ .git/                         # Git backend for jj
â”œâ”€â”€ .hybrid-vcs-config            # Sync configuration
â”œâ”€â”€ writeup/
â”‚   â””â”€â”€ manuscript/
â”‚       â”œâ”€â”€ manuscript.fossil     # Self-contained manuscript repo
â”‚       â””â”€â”€ src/                  # Manuscript source files
â”œâ”€â”€ analysis/
â”‚   â”œâ”€â”€ analysis.fossil          # Computational provenance repo
â”‚   â”œâ”€â”€ notebooks/               # Analysis notebooks
â”‚   â””â”€â”€ data/                    # Research data
â””â”€â”€ archives/
    â”œâ”€â”€ project-archive.fossil   # Long-term preservation
    â””â”€â”€ publication-bundles/     # Export-ready archives
```

## Workflow Integration

### ğŸ“ **Daily Development Workflow**

```bash
# Start development session
just dev-start "exploring new analysis approach"

# Work on analysis (tracked in jj)
# Edit notebooks, modify scripts, update data

# Save progress (auto-syncs to relevant Fossil repos)
just dev-save "completed initial feature engineering"

# End session with milestone
just dev-end "major data preprocessing complete"
```

### ğŸ“– **Manuscript Writing Workflow**

```bash
# Start manuscript session
just manuscript-start "methodology section"

# Write and edit (tracked in both jj and Fossil)
# Manuscript changes are dual-tracked for comprehensive history

# Save progress with detailed versioning
just manuscript-save "added statistical analysis methodology"

# Create submission version
just manuscript-version "journal-submission-v1"
```

### ğŸ”¬ **Analysis Session Workflow**

```bash
# Start analysis with computational tracking
just analysis-start "hypothesis testing for feature X"

# Run analysis (computational environment tracked)
# Python/R versions, dependencies automatically logged

# Save with provenance metadata
just analysis-save "completed statistical tests" --include-data=true
```

## Synchronization Strategy

### ğŸ”„ **Automatic Synchronization**

The system automatically syncs changes based on file paths:

- **Manuscript changes** â†’ Synced to `manuscript.fossil`
- **Analysis changes** â†’ Synced to `analysis.fossil`
- **Major milestones** â†’ Archived in `project-archive.fossil`

### ğŸ“Š **Sync Triggers**

```bash
# Manual comprehensive sync
just sync-all-to-fossil

# Bidirectional sync (advanced)
just bidirectional-sync

# Check sync status
just hybrid-status
```

## Archival and Preservation

### ğŸ“¦ **Archive Creation**

```bash
# Create milestone archive
just create-archive-snapshot "paper-accepted-by-nature"

# Export publication bundle
just export-publication-bundle "nature-submission-2024"

# Generate reproducibility package
just generate-data-checksums
```

### ğŸ¯ **Publication Workflow**

1. **During Research:**
   - Use jj for daily development and collaboration
   - Fossil automatically tracks manuscript and analysis evolution

2. **Pre-Submission:**
   - Create clean jj history for publication
   - Generate Fossil bundles for supplementary materials
   - Export comprehensive archives

3. **Post-Publication:**
   - Archive complete research trail
   - Create self-contained reproducibility packages
   - Maintain long-term accessibility

## Collaboration Patterns

### ğŸ‘¥ **Team Collaboration**

```bash
# Share current experiment
just share-with-collaborators "new analysis approach ready for review"

# Receive updates from team
just receive-updates

# Review collaboration history
just workflow-summary
```

### ğŸŒ **External Sharing**

- **jj/Git**: Share via GitHub/GitLab for real-time collaboration
- **Fossil**: Export bundles for journal submissions and archives
- **Hybrid**: Comprehensive research packages for reproducibility

## Maintenance and Utilities

### ğŸ¥ **System Health**

```bash
# Verify system status
just verify-hybrid-system

# Open Fossil web UIs for browsing
just open-fossil-uis

# Show comprehensive status
just hybrid-status
```

### ğŸ§¹ **Cleanup and Optimization**

```bash
# Clean old experiments
just cleanup-experiments "30 days"

# Optimize repositories
just backup-fossil-repos

# Generate checksums for data integrity
just generate-data-checksums
```

## Best Practices

### ğŸ“‹ **Development Guidelines**

1. **Use jj for daily work** - Primary development in jj with frequent commits
2. **Let Fossil track archives** - Automatic syncing handles Fossil updates
3. **Create meaningful milestones** - Use milestones to trigger archive creation
4. **Maintain clean history** - Use jj's history rewriting before publication

### ğŸ¯ **Academic Workflow Tips**

1. **Manuscript versioning** - Create named versions for each submission
2. **Computational provenance** - Include environment info in analysis saves
3. **Collaboration clarity** - Use descriptive commit messages for both systems
4. **Archive regularly** - Create snapshots at major project milestones

## Installation and Setup

### ğŸ“¦ **Prerequisites**

```bash
# Install Jujutsu
brew install jj  # macOS
# or follow: https://github.com/jj-vcs/jj

# Install Fossil SCM
brew install fossil  # macOS
# or follow: https://fossil-scm.org/home/doc/trunk/www/build.wiki
```

### ğŸš€ **Initialization**

```bash
# Initialize hybrid system
just init-hybrid-vcs

# Verify installation
just verify-hybrid-system

# View workflow guide
just show-workflows
```

## Advanced Features

### ğŸ” **Querying and Analysis**

```bash
# Find recent experiments
just list-experiments 14  # last 14 days

# Show component history
just component-history notebooks

# Generate publication changelog
just publication-changelog "6 months ago"
```

### ğŸ“ˆ **Reporting and Metrics**

```bash
# Comprehensive workflow summary
just workflow-summary

# Show recent changes by type
just notebook-changes "1 week ago"
just data-changes "1 week ago"
just script-changes "1 week ago"
```

## Troubleshooting

### âš ï¸ **Common Issues**

1. **Sync conflicts** - Use `just resolve-conflicts` for jj conflicts
2. **Fossil UI not starting** - Check port availability (8080, 8081, 8082)
3. **Large file handling** - Consider DVC for large datasets in jj
4. **Performance** - Use `.gitignore`/`.ignore` for temporary files

### ğŸ› ï¸ **Recovery Procedures**

```bash
# Restore from archive
fossil clone project-archive.fossil restored-project
cd restored-project && fossil open project-archive.fossil

# Recover manuscript version
fossil timeline -n 100  # Find specific version
fossil checkout [version-id]

# Verify system integrity
just verify-hybrid-system
```

## Integration with Other Tools

### ğŸ”— **Ecosystem Compatibility**

- **CI/CD**: jj/Git integration works with GitHub Actions, GitLab CI
- **IDEs**: Standard Git support works through jj's Git backend
- **Documentation**: Fossil web UI provides built-in documentation hosting
- **Collaboration**: Standard Git workflows + Fossil sharing capabilities

This hybrid approach provides the best of both worlds: modern development workflows with jj and comprehensive archival capabilities with Fossil, perfectly suited for the demanding requirements of academic research.
